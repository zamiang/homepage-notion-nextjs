---
/**
 * Homepage
 * Main landing page with hero, work history, writing, VBC series, and photography
 */

import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

import PhotoCard from '../components/PhotoCard.astro';
import PostCard from '../components/PostCard.astro';
import SeriesPostCard from '../components/SeriesPostCard.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { config } from '../lib/config';

// VBC constants
const VBC_TITLE = 'Why Value-Based Care is Harder Than Rocket Science';
const VBC_DESCRIPTION =
  'This series argues that U.S. healthcare is "harder than rocket science" due to its "consolidated fragmentation," where powerful, siloed players hinder effective, affordable patient care.';

// Load content from collections
let posts: CollectionEntry<'posts'>[] = [];
let vbcPosts: CollectionEntry<'vbcPosts'>[] = [];
let photos: CollectionEntry<'photos'>[] = [];

try {
  posts = await getCollection('posts');
  vbcPosts = (await getCollection('vbcPosts')).sort((a, b) =>
    a.data.title > b.data.title ? 1 : -1,
  );
  photos = await getCollection('photos');
} catch (error) {
  console.warn('Could not load content collections:', error);
  // Continue with empty arrays - this allows the page to render without Notion
}

const siteUrl = config.site.url;

// Schema.org JSON-LD for homepage
const jsonLd = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'Person',
      '@id': `${siteUrl}/#person`,
      name: 'Brennan Moore',
      url: siteUrl,
      image: `${siteUrl}/about.jpg`,
      jobTitle: 'CTO / Engineering Leader',
      description:
        'I see engineering as a creative craft. I build innovative digital products by creating elegant solutions for complex problems.',
      sameAs: [],
    },
    {
      '@type': 'Blog',
      '@id': `${siteUrl}/#blog`,
      name: config.site.title,
      description: config.site.description,
      url: siteUrl,
      author: {
        '@id': `${siteUrl}/#person`,
      },
      blogPost: posts.slice(0, 5).map((post) => ({
        '@type': 'BlogPosting',
        '@id': `${siteUrl}/writing/${post.data.slug}`,
        headline: post.data.title,
        datePublished: new Date(post.data.date).toISOString(),
      })),
    },
  ],
};
---

<BaseLayout>
  <Fragment slot="json-ld">
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </Fragment>

  <div class="homepage">
    {/* Hero & About Section */}
    <article>
      <header class="header">
        <div class="profile-photo-container w-44 h-44 mx-auto rounded-full overflow-hidden mb-5">
          <img
            src="/about.jpg"
            alt="Brennan Moore - Engineering Leader and CTO"
            width="176"
            height="176"
            class="w-full h-full object-cover"
            loading="eager"
          />
        </div>
        <p class="section-label">Engineering Leader & Builder</p>
        <h1 class="section-heading section-heading--hero">Hi, I'm Brennan.</h1>
        <p class="section-subtitle section-subtitle--constrained">
          I build innovative digital products people love.
        </p>
      </header>

      <div class="section">
        <p>
          I work best with small teams, digging into the business to find what actually moves the
          needle. For me, success isn't just shipping a quality product—it's building teams that
          continue to deliver long after launch.
        </p>

        <div class="section-rule"></div>

        <p class="section-label">Currently</p>
        <h3 class="section-heading section-heading--subsection">Consulting</h3>

        {
          (photos.length > 0 || vbcPosts.length > 0) && (
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              {photos.length > 0 && (
                <div>
                  <p class="section-label section-label--tight">Latest photos</p>
                  <PhotoCard post={photos[0].data} shouldHideText priority />
                </div>
              )}
              {vbcPosts.length > 0 && (
                <div>
                  <p class="section-label section-label--tight">Latest writing</p>
                  <PostCard post={vbcPosts[0].data} />
                </div>
              )}
            </div>
          )
        }

        {/* Work Section */}
        <div class="section-rule" id="work"></div>
        <p class="section-label">Career Journey</p>
        <h2 class="section-heading">Work</h2>
        <p class="section-subtitle">
          Building technology teams and products that make a difference.
        </p>

        {/* Work Item: Firsthand */}
        <div class="work-card">
          <div class="work-card-header">
            <time class="work-card-date">2022–2025</time>
            <span class="work-card-role">CTO</span>
          </div>
          <h3 class="work-card-title">
            <a href="https://www.firsthandcares.com">Firsthand</a>
          </h3>
          <p class="work-card-description">
            Led the technology organization across Product, Software, Data, IT, and Security,
            scaling the team from 3 to 25 while supporting rapid physical expansion across 28
            offices. Architected helpinghand, our proprietary AI-powered care management tool, and
            secured HITRUST r2 certification under strict deadlines.
          </p>
        </div>

        {/* Work Item: Kelp */}
        <div class="work-card">
          <div class="work-card-header">
            <time class="work-card-date">2022–2026</time>
            <span class="work-card-role">Founder</span>
          </div>
          <h3 class="work-card-title">
            <a href="https://www.kelp.nyc/">Kelp</a>
          </h3>
          <p class="work-card-description">
            Founded Kelp to filter our ocean of information down to just what you need right now.
            Built a Chrome Extension with integrations across major workplace platforms. Now it is
            an AI assistant focused on helping executives stay current on industry, technology, and
            cultural shifts.
          </p>
          <a href="https://www.kelp.nyc/" class="cta-button mt-4">Try Kelp</a>
        </div>

        {/* Work Item: Cityblock Health */}
        <div class="work-card">
          <div class="work-card-header">
            <time class="work-card-date">2017–2021</time>
            <span class="work-card-role">Founding Engineer</span>
          </div>
          <h3 class="work-card-title">
            <a href="https://www.cityblock.com/">Cityblock Health</a>
          </h3>
          <p class="work-card-description">
            As the 3rd team member, I was instrumental in incubating and launching Cityblock from
            within Alphabet's Sidewalk Labs. My team built the core data and software technology
            foundation, including data-sharing partnerships with payers and Commons—the proprietary
            care management platform.
          </p>
        </div>

        {/* Work Item: More */}
        <div class="work-card">
          <div class="work-card-header">
            <time class="work-card-date">2009–2015</time>
            <span class="work-card-role">Lots of projects</span>
          </div>
          <h3 class="work-card-title">
            <a href="https://www.linkedin.com/in/brennan-moore/">More on LinkedIn</a>
          </h3>
          <p class="work-card-description">
            Many past projects such as leading Artsy.net's public web presence and auctions,
            Motivate (Citi Bike), HCI research at MIT CSAIL and working at the MIT Media lab on
            visualizations for Ars Electronica.
          </p>
        </div>
      </div>
    </article>

    {/* Writing Section */}
    {
      posts.length > 0 && (
        <section class="section-wrapper section-wrapper--warm" id="writing">
          <div class="section-wrapper-inner">
            <p class="section-label">Thoughts & Reflections</p>
            <h2 class="section-heading">Writing</h2>
            <p class="section-subtitle">
              Essays on engineering leadership, startups, and building teams.
            </p>
            <div class="section-rule" />
            {posts.map((post) => (
              <PostCard post={post.data} />
            ))}
          </div>
        </section>
      )
    }

    {/* VBC Section */}
    {
      vbcPosts.length > 0 && (
        <section class="section-wrapper section-wrapper--accent" id="vbc">
          <div class="section-wrapper-inner">
            <p class="section-label">VBC Deep Dive</p>
            <h2 class="section-heading">{VBC_TITLE}</h2>
            <p class="section-subtitle">{VBC_DESCRIPTION}</p>
            <div class="section-rule" />
            {vbcPosts.map((post) => (
              <SeriesPostCard post={post.data} isPast={false} isCurrent={false} isNext={false} />
            ))}
          </div>
        </section>
      )
    }

    {/* Photography Section */}
    {
      photos.length > 0 && (
        <section class="section-wrapper section-wrapper--muted" id="photography">
          <div class="section-wrapper-inner">
            <p class="section-label">Visual Stories</p>
            <h2 class="section-heading">Photography</h2>
            <p class="section-subtitle">Capturing moments from travels and everyday life.</p>
            <div class="section-rule" />
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              {photos.map((post) => (
                <PhotoCard post={post.data} />
              ))}
            </div>
          </div>
        </section>
      )
    }

    {/* Publications Section */}
    <section class="section-wrapper section-wrapper--warm" id="publications">
      <div class="section-wrapper-inner">
        <p class="section-label">Academic Research</p>
        <h2 class="section-heading">Publications</h2>
        <p class="section-subtitle">Peer-reviewed work on personal informatics and automation.</p>
        <div class="section-rule"></div>
        <ul>
          <li>
            <h4>
              <a
                href="https://v1.personalinformatics.org/docs/chi2010/moore_assisted_self_reflection.pdf"
              >
                Assisted Self Reflection: Combining Lifetracking, Sensemaking, & Personal
                Information Management
              </a>
            </h4>
            <p>
              <i>Brennan Moore, Max Van Kleek, David R. Karger, mc schraefel</i>
            </p>
            <p>
              In this paper, we present an ongoing project designed to make self-reflection an
              integral part of daily personal information management activity, and to provide
              facilities for fostering greater self-understanding through exploration of captured
              personal activity logs.
            </p>
          </li>
          <li>
            <h4>
              <a href="https://dl.acm.org/doi/10.1145/1772690.1772787">
                Atomate it! end-user context-sensitive automation using heterogeneous information
                sources on the web
              </a>
            </h4>
            <p>
              <i>Max Van Kleek, Brennan Moore, David R Karger, Paul André, M C Schraefe</i>
            </p>
            <p>
              Our system, Atomate, treats RSS/ATOM feeds from social networking and life-tracking
              sites as sensor streams, integrating information from such feeds into a simple unified
              RDF world model representing people, places and things and their timevarying states
              and activities.
            </p>
          </li>
        </ul>
      </div>
    </section>
  </div>
</BaseLayout>
